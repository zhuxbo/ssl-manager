# SSL证书管理系统 - Nginx 配置
# 在站点配置中使用: include /path/to/nginx/manager.conf;

# 安装页面
location = /install {
    try_files $uri /install.php?$query_string;
}

# 安装资源
location ^~ /install-assets/ {
    try_files $uri =404;
}

# API 和回调
location ~ ^/(api|callback|_ignition) {
    try_files $uri /index.php?$query_string;
}

# SPA 前端应用（admin/user/easy/help）
location ~ ^/(admin|user|easy|help)(/|$) {
    try_files $uri $uri/ /$1/index.html;

    # 带 hash 的静态资源长期缓存
    location ~* \.(js|css|png|jpg|gif|svg|ico|woff2?)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# 首页和其他请求交给 Laravel
location / {
    try_files $uri $uri/ /index.php?$query_string;
}

# PHP 处理（宝塔环境）
# 注意：如果使用 Docker，请使用 Docker 专用配置
location ~ \.php$ {
    try_files $uri =404;
    fastcgi_pass unix:/tmp/php-cgi-83.sock;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    fastcgi_read_timeout 300;
}

# 禁止访问隐藏文件
location ~ /\. {
    deny all;
}

# 禁止访问敏感文件
location ~* \.(env|git|svn|htaccess)$ {
    deny all;
}
